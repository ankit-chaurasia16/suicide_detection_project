<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† Advanced Suicide Detection AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        .neural-network {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
            background: radial-gradient(ellipse at center, rgba(102, 126, 234, 0.15) 0%, transparent 70%);
        }
        
        .node {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #ffffff, #667eea);
            border-radius: 50%;
            animation: neuronPulse 4s ease-in-out infinite;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.7);
        }
        
        .connection {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: synapseFlow 3s ease-in-out infinite;
        }
        
        .data-pulse {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            animation: dataFlow 5s linear;
            box-shadow: 0 0 12px #00ff88;
        }
        
        @keyframes neuronPulse {
            0%, 100% { 
                transform: scale(1); 
                opacity: 0.8;
                box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
            }
            50% { 
                transform: scale(1.6); 
                opacity: 1;
                box-shadow: 0 0 25px rgba(102, 126, 234, 1);
            }
        }
        
        @keyframes synapseFlow {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }
        
        @keyframes dataFlow {
            0% { left: 2%; opacity: 1; transform: scale(1); }
            20% { left: 25%; opacity: 0.9; transform: scale(1.3); }
            40% { left: 50%; opacity: 0.7; transform: scale(1); }
            60% { left: 75%; opacity: 0.5; transform: scale(0.8); }
            100% { left: 98%; opacity: 0; transform: scale(0.4); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: white;
            font-size: 3.2em;
            margin-bottom: 15px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
        }
        
        .subtitle {
            color: rgba(255,255,255,0.95);
            font-size: 1.4em;
            margin-bottom: 25px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 35px;
        }
        
        .nav-btn {
            padding: 15px 30px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.4);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 16px;
        }
        
        .nav-btn:hover, .nav-btn.active {
            background: rgba(255,255,255,0.9);
            color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
            transition: transform 0.3s;
        }
        
        .stat:hover {
            transform: translateY(-8px);
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 1em;
            font-weight: 600;
        }
        
        .input-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 35px;
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            height: fit-content;
        }
        
        .memory-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 35px;
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            max-height: 500px;
            overflow-y: auto;
        }
        
        .memory-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.4em;
        }
        
        .memory-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .memory-text {
            font-size: 14px;
            color: #333;
            margin-bottom: 8px;
        }
        
        .memory-result {
            font-size: 12px;
            color: #666;
            display: flex;
            justify-content: space-between;
        }
        
        .char-count {
            text-align: right;
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
            font-weight: 500;
        }
        
        textarea {
            width: 100%;
            min-height: 180px;
            padding: 25px;
            border: 2px solid #e1e8ed;
            border-radius: 18px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s;
            line-height: 1.6;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 25px rgba(102, 126, 234, 0.3);
        }
        
        .buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            padding: 18px 35px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 30px;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            display: none;
        }
        
        .result h3 {
            margin-bottom: 18px;
            font-size: 1.5em;
        }
        
        .confidence {
            font-size: 1.2em;
            margin: 18px 0;
            font-weight: 600;
        }
        
        .message {
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .high {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .low {
            background: linear-gradient(135deg, #51cf66, #40c057);
            color: white;
        }
        
        .error {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin-top: 30px;
        }
        
        .spinner {
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        .about-content {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            line-height: 1.8;
            columns: 2;
            column-gap: 40px;
        }
        
        .about-content h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2em;
            column-span: all;
        }
        
        .about-content h3 {
            color: #764ba2;
            margin: 25px 0 15px 0;
            font-size: 1.4em;
            break-after: avoid;
        }
        
        .feature-list {
            list-style: none;
            padding-left: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        
        .feature-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #51cf66;
            font-weight: bold;
        }
        
        .disclaimer {
            margin-top: 30px;
            padding: 25px;
            background: rgba(248, 249, 250, 0.9);
            border-radius: 15px;
            font-size: 0.95em;
            color: #666;
            text-align: center;
            line-height: 1.6;
            border-left: 4px solid #ff6b6b;
            grid-column: 1 / -1;
        }
        
        .feedback-section {
            margin-top: 25px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            text-align: center;
        }
        
        .feedback-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .feedback-btn {
            padding: 12px 25px;
            border: 2px solid white;
            background: transparent;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .feedback-btn:hover {
            background: white;
            color: #667eea;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .about-content {
                columns: 1;
            }
        }
        
        @media (max-width: 768px) {
            .stats {
                grid-template-columns: 1fr;
            }
            
            .buttons {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-wrap: wrap;
            }
            
            h1 {
                font-size: 2.5em;
            }
            
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="neural-network" id="neuralNetwork"></div>
    
    <div class="container">
        <div class="header">
            <h1>üß† Advanced Suicide Detection AI</h1>
            <div class="subtitle">Neural Network-Powered Mental Health Analysis System</div>
            
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showPage('home')">üè† Home</button>
                <button class="nav-btn" onclick="showPage('about')">‚ÑπÔ∏è About</button>
                <button class="nav-btn" onclick="showPage('memory')">üß† Memory</button>
                <button class="nav-btn" onclick="showPage('dataset')">üìÅ Dataset</button>
            </div>
        </div>
        
        <!-- Home Page -->
        <div id="home" class="page active">
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="overallAccuracy">84.3%</div>
                    <div class="stat-label">Overall Accuracy</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="suicideDetection">87.8%</div>
                    <div class="stat-label">Suicide Detection</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="nonSuicideDetection">80.9%</div>
                    <div class="stat-label">Non-Suicide Detection</div>
                </div>
            </div>
            
            <div class="main-content">
                <div class="left-panel">
                    <div class="input-section">
                        <div class="char-count" id="charCount">0 / 5000 characters</div>
                        <textarea id="textInput" placeholder="Enter text to analyze for potential suicide risk indicators..."></textarea>
                        
                        <div class="buttons">
                            <button id="analyzeBtn" onclick="analyze()">üîç Analyze Text</button>
                            <button id="clearBtn" onclick="clearAll()">üóëÔ∏è Clear All</button>
                        </div>
                    </div>
                    
                    <div class="loading" id="loading">
                        <div class="spinner"></div>
                        <p>Analyzing with neural network...</p>
                    </div>
                    
                    <div id="result" class="result"></div>
                </div>
                
                <div class="right-panel">
                    <div class="memory-section">
                        <h3>üìù Analysis Memory</h3>
                        <div id="memoryList">
                            <p style="color: #666; text-align: center; padding: 20px;">No analyses stored yet. Start analyzing text to build memory.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="disclaimer">
                <strong>‚ö†Ô∏è Disclaimer:</strong> This AI tool is for educational and research purposes only. It should never replace professional mental health assessment. If you or someone you know is in crisis, please contact emergency services or a mental health professional immediately.
            </div>
        </div>
        
        <!-- About Page -->
        <div id="about" class="page">
            <div class="about-content">
                <h2>üß† About Our Advanced AI System</h2>
                <p>Our Advanced Suicide Detection AI represents a breakthrough in mental health technology, utilizing sophisticated neural networks and machine learning algorithms to identify potential suicide risk indicators in text with 84.3% accuracy.</p>
                
                <h3>üéØ Key Features</h3>
                <ul class="feature-list">
                    <li>Advanced neural network architecture with 84.3% overall accuracy</li>
                    <li>Real-time text analysis and risk assessment</li>
                    <li>Memory system storing analysis history</li>
                    <li>Continuous learning from user interactions</li>
                    <li>Multi-layered security and privacy protection</li>
                    <li>Professional-grade confidence scoring</li>
                    <li>Comprehensive keyword and pattern recognition</li>
                </ul>
                
                <h3>üî¨ Technology Stack</h3>
                <ul class="feature-list">
                    <li>Machine Learning: Custom-trained classification models</li>
                    <li>Natural Language Processing: Advanced text preprocessing</li>
                    <li>Neural Networks: Deep learning architecture</li>
                    <li>Backend: Python Flask with optimized algorithms</li>
                    <li>Frontend: Responsive web interface with real-time updates</li>
                    <li>Memory System: Local storage with analysis history</li>
                </ul>
                
                <h3>üìä Performance Metrics</h3>
                <ul class="feature-list">
                    <li>Overall Accuracy: 84.3% across all test cases</li>
                    <li>Suicide Detection Rate: 87.8% (High sensitivity)</li>
                    <li>Non-Suicide Detection Rate: 80.9% (Low false positives)</li>
                    <li>Processing Speed: Real-time analysis under 2 seconds</li>
                    <li>Training Dataset: 232,074+ text samples</li>
                    <li>Memory Capacity: Unlimited local storage</li>
                </ul>
                
                <h3>üõ°Ô∏è Privacy & Ethics</h3>
                <p>We prioritize user privacy and ethical AI practices. All text analysis is performed locally, and data is stored only in your browser's memory. Our system is designed to assist mental health professionals, not replace them.</p>
                
                <h3>üöÄ Continuous Improvement</h3>
                <p>Our AI system features an adaptive learning mechanism that continuously improves accuracy based on user interactions and feedback, ensuring better performance over time while maintaining complete privacy.</p>
            </div>
        </div>
        
        <!-- Memory Page -->
        <div id="memory" class="page">
            <div class="about-content">
                <h2>üß† Analysis Memory System</h2>
                <p>The memory system stores all your analysis history locally in your browser, allowing you to review past analyses and track patterns over time.</p>
                
                <h3>üìù Stored Information</h3>
                <ul class="feature-list">
                    <li>Original text analyzed</li>
                    <li>AI prediction result</li>
                    <li>Confidence score</li>
                    <li>Timestamp of analysis</li>
                    <li>Risk level assessment</li>
                </ul>
                
                <h3>üîí Privacy Features</h3>
                <ul class="feature-list">
                    <li>All data stored locally in browser</li>
                    <li>No server-side storage of sensitive content</li>
                    <li>Data persists across browser sessions</li>
                    <li>User can clear memory anytime</li>
                    <li>Automatic cleanup of old entries</li>
                </ul>
                
                <div style="margin-top: 30px; text-align: center;">
                    <button onclick="clearMemory()" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52);">üóëÔ∏è Clear All Memory</button>
                </div>
            </div>
        </div>
        
        <!-- Dataset Page -->
        <div id="dataset" class="page">
            <div class="about-content">
                <h2>üìÅ Dataset Upload & Management</h2>
                <p>Upload your own suicide detection dataset to improve model accuracy. The system accepts CSV files with 'text' and 'class' columns.</p>
                
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin: 20px 0;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üì§ Upload Dataset</h3>
                    <input type="file" id="datasetFile" accept=".csv,.zip" style="margin-bottom: 15px; padding: 10px; border: 2px solid #ddd; border-radius: 8px; width: 100%;">
                    <button onclick="uploadDataset()" style="background: linear-gradient(135deg, #51cf66, #40c057); margin-right: 10px;">üöÄ Upload & Train</button>
                    <button onclick="downloadSample()" style="background: linear-gradient(135deg, #667eea, #764ba2);">üìé Download Sample</button>
                </div>
                
                <div id="uploadStatus" style="margin: 20px 0; padding: 15px; border-radius: 10px; display: none;"></div>
                
                <h3>üìà Dataset Requirements</h3>
                <ul class="feature-list">
                    <li>CSV format with headers</li>
                    <li>'text' column containing the text to analyze</li>
                    <li>'class' column with 'suicide' or 'non-suicide' labels</li>
                    <li>Minimum 100 samples recommended</li>
                    <li>Maximum file size: 80MB</li>
                    <li>UTF-8 encoding preferred</li>
                </ul>
                
                <h3>ü§ñ Model Training</h3>
                <ul class="feature-list">
                    <li>Automatic preprocessing of text data</li>
                    <li>Advanced feature extraction</li>
                    <li>Cross-validation for accuracy testing</li>
                    <li>Real-time training progress</li>
                    <li>Model performance metrics</li>
                    <li>Automatic model saving</li>
                </ul>
                
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 10px; margin-top: 20px;">
                    <strong>‚ö†Ô∏è Note:</strong> Training may take several minutes depending on dataset size. The browser will show progress updates during training.
                </div>
            </div>
        </div>
    </div>

    <script>
        const textInput = document.getElementById('textInput');
        const charCount = document.getElementById('charCount');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loading = document.getElementById('loading');
        const resultDiv = document.getElementById('result');
        const memoryList = document.getElementById('memoryList');
        let currentAnalysisId = null;
        
        // Memory system
        function saveToMemory(text, result) {
            let memory = JSON.parse(localStorage.getItem('analysisMemory') || '[]');
            memory.unshift({
                id: Date.now(),
                text: text.substring(0, 100) + (text.length > 100 ? '...' : ''),
                fullText: text,
                result: result.result,
                confidence: result.confidence,
                riskLevel: result.risk_level,
                timestamp: new Date().toLocaleString()
            });
            
            // Keep only last 50 analyses
            if (memory.length > 50) memory = memory.slice(0, 50);
            
            localStorage.setItem('analysisMemory', JSON.stringify(memory));
            updateMemoryDisplay();
        }
        
        function updateMemoryDisplay() {
            const memory = JSON.parse(localStorage.getItem('analysisMemory') || '[]');
            
            if (memory.length === 0) {
                memoryList.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No analyses stored yet. Start analyzing text to build memory.</p>';
                return;
            }
            
            memoryList.innerHTML = memory.map(item => `
                <div class="memory-item">
                    <div class="memory-text">${item.text}</div>
                    <div class="memory-result">
                        <span>${item.result}</span>
                        <span>${item.confidence} - ${item.timestamp}</span>
                    </div>
                </div>
            `).join('');
        }
        
        function clearMemory() {
            if (confirm('Are you sure you want to clear all analysis memory?')) {
                localStorage.removeItem('analysisMemory');
                updateMemoryDisplay();
            }
        }
        
        // Create full-screen neural network
        function createNeuralNetwork() {
            const network = document.getElementById('neuralNetwork');
            const nodes = [];
            
            // Create more nodes for full coverage
            for (let i = 0; i < 120; i++) {
                const node = document.createElement('div');
                node.className = 'node';
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                node.style.left = x + '%';
                node.style.top = y + '%';
                node.style.animationDelay = Math.random() * 4 + 's';
                network.appendChild(node);
                nodes.push({element: node, x: x, y: y});
            }
            
            // Create more connections
            for (let i = 0; i < 80; i++) {
                const connection = document.createElement('div');
                connection.className = 'connection';
                const node1 = nodes[Math.floor(Math.random() * nodes.length)];
                const node2 = nodes[Math.floor(Math.random() * nodes.length)];
                
                if (node1 !== node2) {
                    const dx = node2.x - node1.x;
                    const dy = node2.y - node1.y;
                    const distance = Math.sqrt(dx*dx + dy*dy);
                    const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                    
                    connection.style.width = distance + 'vw';
                    connection.style.left = node1.x + '%';
                    connection.style.top = node1.y + '%';
                    connection.style.transform = 'rotate(' + angle + 'deg)';
                    connection.style.transformOrigin = '0 50%';
                    connection.style.animationDelay = Math.random() * 3 + 's';
                    network.appendChild(connection);
                }
            }
            
            // Add more data pulses
            setInterval(() => {
                const pulse = document.createElement('div');
                pulse.className = 'data-pulse';
                pulse.style.left = '2%';
                pulse.style.top = (10 + Math.random() * 80) + '%';
                network.appendChild(pulse);
                
                setTimeout(() => {
                    if (pulse.parentNode) pulse.parentNode.removeChild(pulse);
                }, 5000);
            }, 1000);
        }
        
        createNeuralNetwork();
        updateMemoryDisplay();
        
        // Page navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
        }
        
        // Character counter
        if (textInput) {
            textInput.addEventListener('input', function() {
                const length = this.value.length;
                charCount.textContent = length + ' / 5000 characters';
                charCount.style.color = length > 4500 ? '#e74c3c' : '#666';
            });
        }
        
        function clearAll() {
            if (textInput) {
                textInput.value = '';
                resultDiv.style.display = 'none';
                charCount.textContent = '0 / 5000 characters';
                charCount.style.color = '#666';
            }
        }
        
        async function analyze() {
            const text = textInput.value.trim();
            
            if (!text) {
                showError('Please enter some text to analyze');
                return;
            }
            
            if (text.length < 10) {
                showError('Please enter at least 10 characters for accurate analysis');
                return;
            }
            
            analyzeBtn.disabled = true;
            loading.style.display = 'block';
            resultDiv.style.display = 'none';
            currentAnalysisId = Date.now();
            
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        text: text,
                        analysis_id: currentAnalysisId
                    })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                } else {
                    showResult(data);
                    saveToMemory(text, data);
                    updateModelStats(data);
                }
            } catch (error) {
                showError('Network error. Please check your connection and try again.');
            } finally {
                analyzeBtn.disabled = false;
                loading.style.display = 'none';
            }
        }
        
        function showResult(data) {
            const feedbackSection = `
                <div class="feedback-section">
                    <p style="color: white; margin-bottom: 10px;">Was this analysis helpful?</p>
                    <div class="feedback-buttons">
                        <button class="feedback-btn" onclick="submitFeedback('positive', '${currentAnalysisId}')">üëç Yes</button>
                        <button class="feedback-btn" onclick="submitFeedback('negative', '${currentAnalysisId}')">üëé No</button>
                    </div>
                </div>
            `;
            
            resultDiv.innerHTML = 
                '<h3>' + data.result + '</h3>' +
                '<div class="confidence">üéØ AI Confidence: ' + data.confidence + '</div>' +
                '<div class="message">' + data.message + '</div>' +
                feedbackSection;
            
            resultDiv.className = 'result ' + data.risk_level;
            resultDiv.style.display = 'block';
        }
        
        async function submitFeedback(type, analysisId) {
            try {
                await fetch('/feedback', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        feedback: type,
                        analysis_id: analysisId,
                        text: textInput.value.trim()
                    })
                });
                
                const feedbackButtons = document.querySelectorAll('.feedback-btn');
                feedbackButtons.forEach(btn => {
                    btn.style.opacity = '0.5';
                    btn.disabled = true;
                });
                
                const feedbackSection = document.querySelector('.feedback-section');
                if (feedbackSection) {
                    feedbackSection.innerHTML = '<p style="color: white;">‚úÖ Thank you for your feedback!</p>';
                }
            } catch (error) {
                console.log('Feedback submission failed:', error);
            }
        }
        
        function updateModelStats(data) {
            if (data.updated_stats) {
                const stats = data.updated_stats;
                document.getElementById('overallAccuracy').textContent = stats.overall_accuracy + '%';
                document.getElementById('suicideDetection').textContent = stats.suicide_detection + '%';
                document.getElementById('nonSuicideDetection').textContent = stats.non_suicide_detection + '%';
            }
        }
        
        function showError(message) {
            resultDiv.innerHTML = '<h3>‚ö†Ô∏è Error</h3><div class="message">' + message + '</div>';
            resultDiv.className = 'result error';
            resultDiv.style.display = 'block';
        }
        
        async function loadCurrentStats() {
            try {
                const response = await fetch('/stats');
                const stats = await response.json();
                if (stats && !stats.error) {
                    updateModelStats({updated_stats: stats});
                }
            } catch (error) {
                console.log('Failed to load current stats:', error);
            }
        }
        
        loadCurrentStats();
        
        // Dataset upload functions
        function uploadDataset() {
            const fileInput = document.getElementById('datasetFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showUploadStatus('Please select a CSV file first.', 'error');
                return;
            }
            
            if (!file.name.endsWith('.csv') && !file.name.endsWith('.zip')) {
                showUploadStatus('Please select a CSV or ZIP file.', 'error');
                return;
            }
            
            if (file.size > 80 * 1024 * 1024) {
                showUploadStatus('File too large. Maximum size is 80MB.', 'error');
                return;
            }
            
            showUploadStatus('Processing dataset...', 'info');
            
            const formData = new FormData();
            formData.append('dataset', file);
            
            fetch('/upload-dataset', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showUploadStatus(`Dataset uploaded successfully! New accuracy: ${data.accuracy}%`, 'success');
                    // Update stats
                    document.getElementById('overallAccuracy').textContent = data.accuracy + '%';
                    document.getElementById('suicideDetection').textContent = data.suicide_detection + '%';
                    document.getElementById('nonSuicideDetection').textContent = data.non_suicide_detection + '%';
                } else {
                    showUploadStatus('Upload failed: ' + data.error, 'error');
                }
            })
            .catch(error => {
                showUploadStatus('Upload failed: Network error', 'error');
            });
        }
        
        function showUploadStatus(message, type) {
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.style.display = 'block';
            statusDiv.textContent = message;
            
            if (type === 'success') {
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                statusDiv.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.style.border = '1px solid #f5c6cb';
            } else {
                statusDiv.style.background = '#d1ecf1';
                statusDiv.style.color = '#0c5460';
                statusDiv.style.border = '1px solid #bee5eb';
            }
        }
        
        function downloadSample() {
            const sampleData = `text,class
"I am feeling very happy today and excited about life",non-suicide
"Life is beautiful and I love spending time with family",non-suicide
"I feel so hopeless and don't want to live anymore",suicide
"Everything seems pointless and I want to end it all",suicide
"Having a great day at work with my colleagues",non-suicide
"I can't take this pain anymore, I want to die",suicide
"Looking forward to my vacation next month",non-suicide
"I feel worthless and nobody would miss me",suicide
"Celebrating my birthday with friends tonight",non-suicide
"I have been thinking about suicide lately",suicide`;
            
            const blob = new Blob([sampleData], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sample_dataset.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>